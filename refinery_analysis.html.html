<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refinery Production Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Soothing Sage -->
    <!-- Application Structure Plan: A single-page dashboard design was chosen to provide a clear, at-a- glance comparison of all refinery tiers while allowing users to drill down into specifics. The primary interaction is a tier selector that dynamically updates all other components (KPI cards, a detailed resource table, and a composition donut chart). This task-oriented flow—comparing tiers, then analyzing one in detail—is more intuitive for data exploration than a linear report, enabling users to quickly identify the most efficient production methods based on their goals (speed vs. resource cost). The new Refinery Fleet Calculator section allows for a task-oriented "what-if" analysis of a user's specific setup, providing direct answers on total output and uranium costs. -->
    <!-- Visualization & Content Choices:
    - Overall Tier Comparison: Report Info: Total Time (s) per Tier. Goal: Compare overall speed. Viz: Bar Chart (Chart.js/Canvas). Interaction: Hover for details, selector updates highlights. Justification: Bar charts are optimal for comparing discrete categories.
    - Tier Composition: Report Info: Time to Craft (s) per Resource for a selected tier. Goal: Analyze resource bottlenecks within a tier. Viz: Donut Chart (Chart.js/Canvas). Interaction: Updates based on tier selector. Justification: Donut charts effectively show part-to-whole relationships.
    - Detailed Data: Report Info: All per-resource data for a selected tier. Goal: Provide granular information. Viz: Styled HTML Table. Interaction: Filters based on tier selector. Justification: Tables are best for presenting precise numerical data for reference.
    - Fleet Calculator: Report Info: User-defined number of refineries per tier, power costs. Goal: Calculate total production and cost. Viz: HTML form and text output. Interaction: User input with a calculation button. Justification: A simple form-based approach is best for user-driven numerical calculations.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f0;
            color: #333333;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }
        .kpi-card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.2s ease-in-out;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
        }
        .tier-button {
            transition: all 0.2s ease-in-out;
            border: 2px solid transparent;
        }
        .tier-button.active {
            background-color: #6b8e23;
            color: #ffffff;
            border-color: #55711c;
            transform: scale(1.05);
        }
        .tier-button:hover:not(.active) {
            background-color: #e0e8e0;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800">Refinery Production Analysis</h1>
            <p class="text-lg text-gray-600 mt-2">Interactive dashboard for analyzing EXO crafting efficiency across different refinery tiers.</p>
        </header>

        <main>
            <!-- Tier Comparison Chart Section -->
            <section class="mb-12 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4 text-center">Overall Crafting Time Comparison</h2>
                <p class="text-center text-gray-500 mb-6">This chart compares the total time required to craft one EXO for each refinery tier. Lower bars indicate higher efficiency. Select a tier from the controls below to see more detailed information.</p>
                <div class="chart-container">
                    <canvas id="tierComparisonChart"></canvas>
                </div>
            </section>

            <!-- Interactive Controls -->
            <section class="mb-8 p-6 bg-white rounded-xl shadow-lg">
                <h3 class="text-xl font-semibold text-center mb-4 text-gray-700">Select Refinery Tier</h3>
                <div id="tierSelector" class="flex flex-wrap justify-center gap-3">
                    <!-- Buttons will be injected by JS -->
                </div>
            </section>
            
            <!-- Dynamic Data Display Section -->
            <section id="detailsSection" class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
                <!-- KPI Cards -->
                <div class="lg:col-span-1 flex flex-col gap-8">
                    <div class="kpi-card text-center">
                        <h4 class="text-lg font-medium text-gray-500">Total Craft Time</h4>
                        <p id="totalTime" class="text-4xl font-bold text-[#6b8e23]">-</p>
                        <span class="text-gray-500">seconds</span>
                    </div>
                    <div class="kpi-card text-center">
                        <h4 class="text-lg font-medium text-gray-500">Total Ore Required</h4>
                        <p id="totalOre" class="text-4xl font-bold text-[#6b8e23]">-</p>
                        <span class="text-gray-500">units</span>
                    </div>
                     <div class="kpi-card text-center">
                        <h4 class="text-lg font-medium text-gray-500">"Abyss" Time</h4>
                        <p id="abyssTime" class="text-4xl font-bold text-[#6b8e23]">-</p>
                        <span class="text-gray-500">seconds (50% of total)</span>
                    </div>
                </div>

                <!-- Detailed Resource Table -->
                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">Resource Breakdown for <span id="selectedTierName" class="text-[#6b8e23]">...</span></h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="p-3 font-semibold">Resource</th>
                                    <th class="p-3 font-semibold">Needed Ore</th>
                                    <th class="p-3 font-semibold">Craft Time (s)</th>
                                </tr>
                            </thead>
                            <tbody id="resourceTableBody">
                                <!-- Rows will be injected by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Resource Composition Chart -->
            <section class="bg-white p-6 rounded-xl shadow-lg mb-12">
                 <h2 class="text-2xl font-semibold text-gray-700 mb-4 text-center">Crafting Time Contribution</h2>
                <p class="text-center text-gray-500 mb-6">This chart illustrates which resources consume the most time in the crafting process for the selected tier, helping to identify production bottlenecks.</p>
                <div class="chart-container h-[450px] max-h-[60vh]">
                    <canvas id="compositionChart"></canvas>
                </div>
            </section>

            <!-- Refinery Fleet Calculator Section -->
            <section class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4 text-center">Refinery Fleet Calculator</h2>
                <p class="text-center text-gray-500 mb-6">Calculate the total uranium cost and EXO output for your specific refinery fleet. Enter the number of refineries you have for each tier.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <div class="flex flex-col gap-2">
                        <label for="t4t0-count" class="font-semibold text-gray-600">T4T0 Refineries</label>
                        <input type="number" id="t4t0-count" value="0" min="0" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#6b8e23]">
                    </div>
                    <div class="flex flex-col gap-2">
                        <label for="t4t4-count" class="font-semibold text-gray-600">T4T4 Refineries</label>
                        <input type="number" id="t4t4-count" value="0" min="0" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#6b8e23]">
                    </div>
                    <div class="flex flex-col gap-2">
                        <label for="t4t5-count" class="font-semibold text-gray-600">T4T5 Refineries</label>
                        <input type="number" id="t4t5-count" value="0" min="0" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#6b8e23]">
                    </div>
                    <div class="flex flex-col gap-2">
                        <label for="t5t0-count" class="font-semibold text-gray-600">T5T0 Refineries</label>
                        <input type="number" id="t5t0-count" value="0" min="0" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#6b8e23]">
                    </div>
                    <div class="flex flex-col gap-2">
                        <label for="t5t4-count" class="font-semibold text-gray-600">T5T4 Refineries</label>
                        <input type="number" id="t5t4-count" value="0" min="0" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#6b8e23]">
                    </div>
                    <div class="flex flex-col gap-2">
                        <label for="t5t5-count" class="font-semibold text-gray-600">T5T5 Refineries</label>
                        <input type="number" id="t5t5-count" value="0" min="0" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#6b8e23]">
                    </div>
                </div>

                <div class="flex items-center justify-center mb-6">
                    <input type="checkbox" id="abyss-toggle" class="h-5 w-5 text-[#6b8e23] border-gray-300 rounded focus:ring-[#6b8e23]">
                    <label for="abyss-toggle" class="ml-2 text-gray-700 font-semibold">Enable Abyss Calculation (Double production)</label>
                </div>

                <div class="flex justify-center mb-8">
                    <button id="calculateFleet" class="bg-[#6b8e23] text-white font-bold py-3 px-6 rounded-lg hover:bg-[#55711c] transition-colors">Calculate Fleet Efficiency</button>
                </div>

                <div id="fleetResults" class="grid grid-cols-1 md:grid-cols-2 gap-6 text-center">
                    <div class="kpi-card">
                        <h4 class="text-lg font-medium text-gray-500">Total Uranium Cost (per day)</h4>
                        <p id="totalUraniumCost" class="text-4xl font-bold text-[#6b8e23]">0</p>
                        <span class="text-gray-500">ingots</span>
                    </div>
                    <div class="kpi-card">
                        <h4 class="text-lg font-medium text-gray-500">Total EXOs Crafted (per day)</h4>
                        <p id="totalExoOutput" class="text-4xl font-bold text-[#6b8e23]">0</p>
                        <span class="text-gray-500">units</span>
                    </div>
                </div>

                <!-- NEW: Ore breakdown table -->
                <div id="fleetOreResults" class="mt-8">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700 text-center">Total Ore Required (per day)</h3>
                    <div class="overflow-x-auto bg-gray-50 p-4 rounded-lg shadow-inner">
                        <table class="w-full text-left">
                            <thead class="bg-gray-200">
                                <tr>
                                    <th class="p-3 font-semibold text-gray-600">Resource</th>
                                    <th class="p-3 font-semibold text-gray-600">Total Needed Ore (per day)</th>
                                    <th class="p-3 font-semibold text-gray-600">Ingots Produced (per day)</th>
                                </tr>
                            </thead>
                            <tbody id="fleetOreBreakdown">
                                 <tr><td colspan="3" class="p-3 text-center text-gray-500">Calculate to see results.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>

        <footer class="text-center mt-12 py-4 border-t border-gray-300">
            <p class="text-gray-500">Dashboard generated based on provided refinery analysis data.</p>
        </footer>
    </div>

    <script>
        const refineryData = {
            "T4T0": {
                totalTime: 425.51,
                totalOre: 22052,
                abyssTime: 212.76,
                powerCostPerRefinery: 250,
                ingotsPer10k: { GOLD: 280, URANIUM: 280, SILVER: 2800, PLAT: 140, SILICON: 19600, COBALT: 8400, IRON: 19600 },
                timePer10k: { GOLD: 83, URANIUM: 821, SILVER: 205, PLAT: 616, SILICON: 123, COBALT: 616, IRON: 10 },
                resources: [
                    { name: "Gold", ore: 14286, time: 118.57 },
                    { name: "Uranium", ore: 1786, time: 146.56 },
                    { name: "Silver", ore: 2143, time: 43.93 },
                    { name: "Plat", ore: 715, time: 44.04 },
                    { name: "Silicon", ore: 1021, time: 12.56 },
                    { name: "Cobalt", ore: 953, time: 58.70 },
                    { name: "Iron", ore: 1148, time: 1.15 }
                ]
            },
            "T4T4": {
                totalTime: 312.1,
                totalOre: 16169,
                abyssTime: 156.05,
                powerCostPerRefinery: 250,
                ingotsPer10k: { GOLD: 382, URANIUM: 382, SILVER: 3820, PLAT: 191, SILICON: 26700, COBALT: 11400, IRON: 26700 },
                timePer10k: { GOLD: 83, URANIUM: 821, SILVER: 205, PLAT: 616, SILICON: 123, COBALT: 616, IRON: 10 },
                resources: [
                    { name: "Gold", ore: 10471, time: 86.91 },
                    { name: "Uranium", ore: 1309, time: 107.46 },
                    { name: "Silver", ore: 1571, time: 32.20 },
                    { name: "Plat", ore: 524, time: 32.25 },
                    { name: "Silicon", ore: 749, time: 9.21 },
                    { name: "Cobalt", ore: 702, time: 43.23 },
                    { name: "Iron", ore: 843, time: 0.84 }
                ]
            },
            "T4T5": {
                totalTime: 182.65,
                totalOre: 9469,
                abyssTime: 91.33,
                powerCostPerRefinery: 250,
                ingotsPer10k: { GOLD: 652, URANIUM: 652, SILVER: 6520, PLAT: 326, SILICON: 45600, COBALT: 19600, IRON: 45600 },
                timePer10k: { GOLD: 83, URANIUM: 821, SILVER: 205, PLAT: 616, SILICON: 123, COBALT: 616, IRON: 10 },
                resources: [
                    { name: "Gold", ore: 6135, time: 50.92 },
                    { name: "Uranium", ore: 767, time: 62.96 },
                    { name: "Silver", ore: 920, time: 18.86 },
                    { name: "Plat", ore: 307, time: 18.89 },
                    { name: "Silicon", ore: 439, time: 5.39 },
                    { name: "Cobalt", ore: 408, time: 25.14 },
                    { name: "Iron", ore: 493, time: 0.49 }
                ]
            },
            "T5T0": {
                totalTime: 227.14,
                totalOre: 20581,
                abyssTime: 113.57,
                powerCostPerRefinery: 350,
                ingotsPer10k: { GOLD: 300, URANIUM: 300, SILVER: 3000, PLAT: 150, SILICON: 21000, COBALT: 9000, IRON: 21000 },
                timePer10k: { GOLD: 47, URANIUM: 470, SILVER: 120, PLAT: 352, SILICON: 70, COBALT: 352, IRON: 6 },
                resources: [
                    { name: "Gold", ore: 13333, time: 62.66 },
                    { name: "Uranium", ore: 1667, time: 78.35 },
                    { name: "Silver", ore: 2000, time: 24.00 },
                    { name: "Plat", ore: 667, time: 23.49 },
                    { name: "Silicon", ore: 953, time: 6.67 },
                    { name: "Cobalt", ore: 890, time: 31.33 },
                    { name: "Iron", ore: 1071, time: 0.64 }
                ]
            },
            "T5T4": {
                totalTime: 166.53,
                totalOre: 15096,
                abyssTime: 83.27,
                powerCostPerRefinery: 350,
                ingotsPer10k: { GOLD: 409, URANIUM: 409, SILVER: 4090, PLAT: 204, SILICON: 28600, COBALT: 12300, IRON: 28600 },
                timePer10k: { GOLD: 47, URANIUM: 470, SILVER: 120, PLAT: 352, SILICON: 70, COBALT: 352, IRON: 6 },
                resources: [
                    { name: "Gold", ore: 9780, time: 45.97 },
                    { name: "Uranium", ore: 1222, time: 57.43 },
                    { name: "Silver", ore: 1467, time: 17.60 },
                    { name: "Plat", ore: 490, time: 17.25 },
                    { name: "Silicon", ore: 699, time: 4.89 },
                    { name: "Cobalt", ore: 651, time: 22.92 },
                    { name: "Iron", ore: 787, time: 0.47 }
                ]
            },
            "T5T5": {
                totalTime: 97.55,
                totalOre: 8844,
                abyssTime: 48.78,
                powerCostPerRefinery: 350,
                ingotsPer10k: { GOLD: 698, URANIUM: 698, SILVER: 6980, PLAT: 349, SILICON: 48900, COBALT: 21000, IRON: 48900 },
                timePer10k: { GOLD: 47, URANIUM: 470, SILVER: 120, PLAT: 352, SILICON: 70, COBALT: 352, IRON: 6 },
                resources: [
                    { name: "Gold", ore: 5731, time: 26.93 },
                    { name: "Uranium", ore: 716, time: 33.65 },
                    { name: "Silver", ore: 860, time: 10.32 },
                    { name: "Plat", ore: 287, time: 10.10 },
                    { name: "Silicon", ore: 409, time: 2.86 },
                    { name: "Cobalt", ore: 381, time: 13.41 },
                    { name: "Iron", ore: 460, time: 0.28 }
                ]
            }
        };

        let comparisonChart, compositionChart;
        let selectedTier = "T4T0"; 

        document.addEventListener('DOMContentLoaded', () => {
            populateTierSelector();
            createTierComparisonChart();
            createCompositionChart();
            updateDashboard(selectedTier);
            
            document.getElementById('calculateFleet').addEventListener('click', calculateFleetEfficiency);
            document.getElementById('abyss-toggle').addEventListener('change', calculateFleetEfficiency);
        });

        function populateTierSelector() {
            const selector = document.getElementById('tierSelector');
            selector.innerHTML = '';
            Object.keys(refineryData).forEach(tier => {
                const button = document.createElement('button');
                button.textContent = tier;
                button.dataset.tier = tier;
                button.className = 'tier-button px-4 py-2 bg-gray-200 rounded-lg font-semibold text-gray-700';
                if (tier === selectedTier) {
                    button.classList.add('active');
                }
                button.addEventListener('click', () => {
                    selectedTier = tier;
                    updateDashboard(tier);
                    
                    document.querySelectorAll('.tier-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                });
                selector.appendChild(button);
            });
        }
        
        function updateDashboard(tier) {
            const data = refineryData[tier];
            if (!data) return;

            document.getElementById('totalTime').textContent = data.totalTime.toFixed(2);
            document.getElementById('abyssTime').textContent = data.abyssTime.toFixed(2);
            document.getElementById('selectedTierName').textContent = tier;

            const tableBody = document.getElementById('resourceTableBody');
            tableBody.innerHTML = '';
            data.resources.forEach(res => {
                const row = `
                    <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="p-3">${res.name}</td>
                        <td class="p-3">${res.ore.toLocaleString()}</td>
                        <td class="p-3">${res.time.toFixed(2)}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
            document.getElementById('totalOre').textContent = data.totalOre.toLocaleString();

            updateChartData(compositionChart, data.resources.map(r => r.name), data.resources.map(r => r.time));
            updateComparisonChartHighlight(tier);
        }

        function createTierComparisonChart() {
            const ctx = document.getElementById('tierComparisonChart').getContext('2d');
            const tiers = Object.keys(refineryData);
            const totalTimes = tiers.map(tier => refineryData[tier].totalTime);

            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: tiers,
                    datasets: [{
                        label: 'Total Crafting Time (s)',
                        data: totalTimes,
                        backgroundColor: tiers.map(t => t === selectedTier ? '#6b8e23' : '#a9a9a9'),
                        borderColor: tiers.map(t => t === selectedTier ? '#55711c' : '#999999'),
                        borderWidth: 1,
                        borderRadius: 5,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Time in Seconds'
                            }
                        },
                        x: {
                             title: {
                                display: true,
                                text: 'Refinery Tier'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Time: ${context.raw.toFixed(2)}s`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function updateComparisonChartHighlight(selectedTier) {
            const tiers = Object.keys(refineryData);
            comparisonChart.data.datasets[0].backgroundColor = tiers.map(t => t === selectedTier ? '#6b8e23' : '#a9a9a9');
            comparisonChart.data.datasets[0].borderColor = tiers.map(t => t === selectedTier ? '#55711c' : '#999999');
            comparisonChart.update();
        }

        function createCompositionChart() {
            const ctx = document.getElementById('compositionChart').getContext('2d');
            compositionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Craft Time Contribution',
                        data: [],
                        backgroundColor: [
                            '#6b8e23', '#d2b48c', '#a9a9a9', '#8fbc8f', '#f0e68c', '#add8e6', '#dda0dd'
                        ],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                         tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.chart.getDatasetMeta(0).total;
                                    const percentage = ((value / total) * 100).toFixed(2);
                                    return `${label}: ${value.toFixed(2)}s (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateChartData(chart, newLabels, newData) {
            chart.data.labels = newLabels;
            chart.data.datasets.forEach((dataset) => {
                dataset.data = newData;
            });
            chart.update();
        }

        function calculateFleetEfficiency() {
            const secondsInDay = 86400;

            let totalUraniumCostPerDay = 0;
            let totalExoOutputPerDay = 0;
            const useAbyssYield = document.getElementById('abyss-toggle').checked;

            let totalOresNeeded = {};
            let totalIngotsProduced = {};

            const tiers = Object.keys(refineryData);
            tiers.forEach(tier => {
                const count = parseInt(document.getElementById(`${tier.toLowerCase()}-count`).value) || 0;
                if (count > 0) {
                    const data = refineryData[tier];
                    
                    const powerCostPerDayIngots = data.powerCostPerRefinery * 24;
                    totalUraniumCostPerDay += powerCostPerDayIngots * count;
                    
                    const timePerUraniumIngot = data.timePer10k.URANIUM / data.ingotsPer10k.URANIUM;
                    
                    const timeToCraftUraniumForTier = timePerUraniumIngot * powerCostPerDayIngots;

                    const netAvailableTimePerRefinery = secondsInDay - timeToCraftUraniumForTier;
                    
                    // --- CORRECTED LOGIC ---
                    // 1. Calculate base EXO output on NORMAL craft time. This determines ore consumption.
                    const baseExoCraftTime = data.totalTime;
                    const baseExosFromThisFleet = (netAvailableTimePerRefinery / baseExoCraftTime) * count;

                    // 2. Abyss doubles the FINAL output, not the speed.
                    const finalExosFromThisFleet = useAbyssYield ? baseExosFromThisFleet * 2 : baseExosFromThisFleet;
                    totalExoOutputPerDay += finalExosFromThisFleet;

                    // 3. Calculate ore and ingots.
                    data.resources.forEach(resource => {
                        // Ore needed is based on the NON-Abyss output, as the amount of ore processed doesn't change.
                        const oreForThisFleet = resource.ore * baseExosFromThisFleet;
                        
                        // Ingots produced are based on the ore processed, with the yield doubled by Abyss.
                        const resourceNameUpper = resource.name.toUpperCase();
                        let ingotsForThisFleet = (oreForThisFleet / 10000) * data.ingotsPer10k[resourceNameUpper];
                        if (useAbyssYield) {
                            ingotsForThisFleet *= 2;
                        }

                        if (totalOresNeeded[resource.name]) {
                            totalOresNeeded[resource.name] += oreForThisFleet;
                            totalIngotsProduced[resource.name] += ingotsForThisFleet;
                        } else {
                            totalOresNeeded[resource.name] = oreForThisFleet;
                            totalIngotsProduced[resource.name] = ingotsForThisFleet;
                        }
                    });
                }
            });

            document.getElementById('totalUraniumCost').textContent = totalUraniumCostPerDay.toLocaleString(undefined, { maximumFractionDigits: 0 });
            document.getElementById('totalExoOutput').textContent = totalExoOutputPerDay.toFixed(2);

            const oreTableBody = document.getElementById('fleetOreBreakdown');
            oreTableBody.innerHTML = ''; 

            const sortedOreNames = Object.keys(totalOresNeeded).sort();

            if (sortedOreNames.length === 0) {
                oreTableBody.innerHTML = `<tr><td colspan="3" class="p-3 text-center text-gray-500">Enter refinery counts to see ore requirements.</td></tr>`;
            } else {
                sortedOreNames.forEach(oreName => {
                    const totalOreAmount = totalOresNeeded[oreName];
                    const totalIngotAmount = totalIngotsProduced[oreName];
                    const row = `
                        <tr class="border-b border-gray-200 hover:bg-gray-100">
                            <td class="p-3 font-medium">${oreName}</td>
                            <td class="p-3">${totalOreAmount.toLocaleString(undefined, { maximumFractionDigits: 0 })}</td>
                            <td class="p-3">${totalIngotAmount.toLocaleString(undefined, { maximumFractionDigits: 0 })}</td>
                        </tr>
                    `;
                    oreTableBody.innerHTML += row;
                });
            }
        }
    </script>
</body>
</html>
